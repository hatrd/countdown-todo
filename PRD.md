# Countdown Todo（Tauri 桌面版）PRD v0.1

## 1. 文档信息
- 产品名称：Countdown Todo
- 文档版本：v0.1（讨论稿）
- 创建日期：2026-02-11
- 目标平台：Windows（主用）/ Linux / macOS（跨平台）
- 开发环境：以 Linux 为主，使用 Tauri 技术栈

---

## 2. 背景与目标

### 2.1 背景
用户希望在假期中进行高密度、可回溯的时间管理：
1. 以“截止时间”为核心进行倒计时管理（分钟级）；
2. 可随时记录 `mark`（时间点 + 阶段工作描述）；
3. 与 `todo` 联动，快速把任务内容写入 `mark` 描述；
4. 全部数据使用纯文本 CSV，便于后续被脚本/其他程序处理。

### 2.2 产品目标（Goals）
1. 提供一个轻量跨平台 GUI 工具，核心流程 3 次点击内可完成 `mark` 记录。
2. 每个计时实例清晰显示“距截止时间剩余分钟数”。
3. 形成可追溯时间日志：任意两次 mark 之间的“做了什么”可回看、可导出（CSV 原生）。
4. 保证 CSV 数据结构稳定，便于后续自动化分析。

### 2.3 非目标（Non-Goals）
1. 不做云同步与多设备实时协作（v1 不包含）。
2. 不做复杂项目管理能力（甘特图、依赖关系、多人指派）。
3. 不做移动端 App。

---

## 3. 目标用户与核心场景

### 3.1 目标用户
- 单人高频自我管理用户（学习/开发/备考/短期冲刺场景）。

### 3.2 典型场景
1. 用户创建一个“假期冲刺”计时实例，设置截止时间。
2. 每做完一个阶段，点一次 `Mark`，写下这段时间完成内容。
3. 平时把 `todo` 写好，mark 时可一键插入 todo 文本，减少手打。
4. 假期结束后，直接用 CSV 做统计分析（例如每日产出、阶段耗时）。

---

## 4. 功能范围（v1）

### 4.1 计时实例管理（Timer）
#### 必选能力
1. 创建计时实例：名称、截止时间（精确到分钟）。
2. 查看计时实例列表：名称、状态、剩余分钟数。
3. 编辑计时实例：名称/截止时间。
4. 归档计时实例（而非硬删除，避免数据断裂）。

#### 展示规则
1. 剩余分钟数 = `target_at - now`，向下取整。
2. 超时后显示负值或“已超时 X 分钟”（具体文案可配置）。
3. 列表默认按截止时间升序。

### 4.2 Mark 记录
#### 必选能力
1. 对当前选中 timer 执行 `Mark Now`。
2. 自动计算：
   - `marked_at`（当前时间）
   - `prev_marked_at`（同 timer 上一次 mark 时间，无则为空）
   - `duration_minutes`（两次 mark 间隔分钟数，无上次则为空）
3. 录入描述 `description`（支持手写 + todo 快速插入）。
4. 显示 mark 历史列表（时间倒序）。

#### 约束
1. 每次 mark 必须关联一个 timer。
2. 空描述允许提交（可配置是否强制最少字数，v1 默认不强制）。
3. mark 提交后必须立即持久化到 `marks.csv`；程序退出并重启后，仍可读取该 timer 的上一条 mark 作为后续 `prev_marked_at` 基准，避免长期任务中断。

### 4.3 Todo 管理与联动
#### 必选能力
1. 添加 todo（标题、状态）。
2. 标记完成/未完成。
3. 在 mark 输入区域中“一键插入”一个或多个 todo 标题。
4. mark 保存时记录已插入 todo 的引用 ID 列表。

#### v1 状态定义
- `open` / `done`

### 4.4 数据存储（CSV）
#### 原则
1. 仅本地文件，UTF-8 编码。
2. 单文件单实体，便于外部处理。
3. 原子写入（先写临时文件，再替换），避免异常中断造成损坏。

#### 文件清单
1. `data/timers.csv`
2. `data/marks.csv`
3. `data/todos.csv`

---

## 5. 数据模型定义（CSV Schema）

### 5.1 timers.csv
表头：
`id,name,target_at,created_at,updated_at,archived`

字段说明：
1. `id`：UUID 字符串。
2. `name`：计时实例名称。
3. `target_at`：截止时间，ISO 8601（带时区）。
4. `created_at`：创建时间，ISO 8601。
5. `updated_at`：更新时间，ISO 8601。
6. `archived`：`true/false`。

### 5.2 marks.csv
表头：
`id,timer_id,marked_at,prev_marked_at,duration_minutes,description,todo_ids`

字段说明：
1. `id`：UUID。
2. `timer_id`：关联 `timers.id`。
3. `marked_at`：当前 mark 时间，ISO 8601。
4. `prev_marked_at`：上一条 mark 时间，可为空。
5. `duration_minutes`：整数，可为空。
6. `description`：文本（CSV 转义）。
7. `todo_ids`：用 `;` 拼接的 todo_id 列表，可为空。

### 5.3 todos.csv
表头：
`id,timer_id,title,status,created_at,updated_at,done_at`

字段说明：
1. `id`：UUID。
2. `timer_id`：关联 `timers.id`。
3. `title`：todo 文本。
4. `status`：`open` 或 `done`。
5. `created_at` / `updated_at` / `done_at`：ISO 8601，`done_at` 可为空。

---

## 6. 关键交互流程

### 6.1 创建计时实例
1. 用户点击“新建 Timer”。
2. 输入名称、截止时间。
3. 保存后进入列表并实时显示倒计时分钟数。

### 6.2 快速 Mark
1. 用户在左侧选中某个 timer。
2. 在右侧 mark 输入区写描述（可点选 todo 插入）。
3. 点击 `Mark Now`。
4. 系统写入 `marks.csv`，并刷新历史记录。

### 6.3 Todo 插入 Mark 描述
1. 在 todo 列表点击“插入到描述”。
2. 文本片段追加到 mark 输入框。
3. 提交 mark 后记录 `todo_ids` 引用。

---

## 7. UI 信息架构（v1）

### 7.1 主界面分区
1. 左栏：Timer 列表（名称、剩余分钟、状态）。
2. 中栏：Mark 编辑区（文本框 + `Mark Now` 按钮）。
3. 右栏：
   - 上半：Mark 历史
   - 下半：Todo 列表（含插入按钮）

### 7.2 可用性要求
1. 常用操作键盘可达（Tab 导航、Enter 提交）。
2. 重要按钮提供快捷键（例如 `Ctrl/Cmd + Enter` 提交 mark）。
3. 倒计时刷新不应影响输入流畅度。

---

## 8. 非功能需求

### 8.1 性能
1. 数据量目标：
   - 50 个 timer
   - 10,000 条 marks
   - 5,000 条 todos
2. 主界面冷启动 < 2 秒（普通笔记本环境）。
3. mark 提交写盘完成反馈 < 200ms（常规场景）。

### 8.2 可靠性
1. CSV 写入采用原子替换。
2. 关键操作失败要有可读错误提示。
3. 启动时做基础数据校验（缺列/损坏提示并给出恢复建议）。
4. 应用重启后必须可从 CSV 恢复每个 timer 的最近 mark 状态，保证 mark 链条连续。

### 8.3 跨平台
1. Linux 开发与运行可用。
2. Windows 为重点交付平台。
3. 文件路径与换行处理遵循跨平台兼容策略。

---

## 9. 技术方案（实现级别）

### 9.1 技术栈
1. 桌面容器：Tauri v2
2. 后端逻辑：Rust
3. 前端：Svelte（建议）
4. 数据序列化：Rust `csv` + `serde`
5. 时间处理：Rust `chrono` / `time`

### 9.2 模块划分
1. `timer_service`：timer CRUD 与剩余分钟计算。
2. `mark_service`：mark 创建、前一条 mark 查询、时长计算。
3. `todo_service`：todo CRUD 与状态变更。
4. `csv_repo`：统一读写与原子落盘。
5. `tauri_commands`：前端调用入口。

### 9.3 错误处理
1. 前端统一 toast 错误提示。
2. Rust 侧返回结构化错误码（I/O、校验、解析失败等）。

---

## 10. 验收标准（v1）

1. 可创建/编辑/归档 timer，并实时看到剩余分钟数。
2. 可连续执行 mark，且自动计算并保存两次 mark 间隔分钟。
3. 可管理 todo，并可一键插入到 mark 描述。
4. 关闭重开应用后，CSV 数据可完整恢复。
5. 在 Windows 与 Linux 均可运行核心流程。
6. 对任一 timer 执行一次 mark 后退出应用，重启并再次 mark 时，`prev_marked_at` 必须指向重启前最后一次 mark。

---

## 11. 风险与待确认项

### 11.1 风险
1. CSV 在高频写入下可能出现并发冲突（需串行化写入）。
2. 跨时区/夏令时可能影响分钟计算（需统一时区策略）。
3. Windows 打包与签名流程可能影响交付节奏。

### 11.2 待确认（下轮讨论）
1. “超时展示”采用负分钟还是独立文案？
2. mark 描述是否要求最少字数？
3. todo 是否需要优先级与截止时间（v1.1 还是 v1）？
4. 是否需要“导出筛选结果”为新 CSV（而非仅原始数据）？

---

## 12. v1.1 候选增强（非本期）
1. 每日统计视图（今日累计投入分钟、按 timer 聚合）。
2. 模板化 mark（常用短语）。
3. 快捷键自定义。
4. 自动备份与恢复向导。
